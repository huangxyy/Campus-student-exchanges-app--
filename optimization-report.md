# ğŸ” å…¨é“¾è·¯ä»£ç ä¼˜åŒ–åˆ†ææŠ¥å‘Š

> æ‰«æèŒƒå›´ï¼šutils/ï¼ˆ20 ä¸ªæ–‡ä»¶ï¼‰ã€store/ï¼ˆ1 ä¸ªï¼‰ã€components/ï¼ˆ2 ä¸ªï¼‰ã€pages/ï¼ˆ35 ä¸ªï¼‰ã€App.vueã€vite.config.js  
> ç”Ÿæˆæ—¶é—´ï¼š2026-02-16

---

## ä¸€ã€Utils å·¥å…·å±‚

### 1.1 âš ï¸ é‡å¤ä»£ç ï¼š`getCurrentUserId` / `wait` æ•£è½ 8+ ä¸ªæ–‡ä»¶

**ç°çŠ¶**ï¼šä»¥ä¸‹å‡½æ•°åœ¨ `chat-service`ã€`order-service`ã€`feed-service`ã€`want-service`ã€`wiki-service`ã€`points-service`ã€`trust-service`ã€`favorite-service`ã€`report-service` ä¸­å„å¤åˆ¶äº†ä¸€ä»½ï¼š

```js
function getCurrentProfile() { return getStoredUser() || {}; }
function getCurrentUserId()  { return getCurrentProfile().userId || ""; }
function wait(ms = 80)       { return new Promise(r => setTimeout(r, ms)); }
```

**ä¼˜åŒ–**ï¼šæå–åˆ° `utils/common.js`ï¼Œæ‰€æœ‰ service ç»Ÿä¸€å¯¼å…¥ã€‚

**æ”¶ç›Š**ï¼šå‡å°‘ ~50 è¡Œé‡å¤ä»£ç ï¼Œç»´æŠ¤å•ä¸€å…¥å£ã€‚

---

### 1.2 âš ï¸ é”™è¯¯å¤„ç†ä¸ä¸€è‡´

**ç°çŠ¶**ï¼š
- âœ… `task-service.js`ã€`order-service.js` ä½¿ç”¨äº† `showError` / `withGuard`
- âŒ `feed-service`ã€`want-service`ã€`wiki-service`ã€`favorite-service`ã€`points-service` æœªä½¿ç”¨ä»»ä½•ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼Œå„è‡ª `try/catch` é™é»˜åæ‰å¼‚å¸¸

**ä¼˜åŒ–**ï¼šæ‰€æœ‰ service çš„å…¬å¼€æ–¹æ³•ç»Ÿä¸€ä½¿ç”¨ `withGuard` åŒ…è£¹ï¼Œç¡®ä¿ï¼š
1. é˜²é‡å¤æäº¤
2. é”™è¯¯åˆ†ç±» + ç”¨æˆ·æç¤º
3. è‡ªåŠ¨é‡Šæ”¾é”

---

### 1.3 ğŸ› Bugï¼š`sanitize.js` å…¨å±€æ­£åˆ™ lastIndex é—®é¢˜

**ç°çŠ¶**ï¼š`containsSensitiveWords` ä½¿ç”¨å¸¦ `g` æ ‡å¿—çš„æ­£åˆ™è°ƒç”¨ `.test()`ã€‚å…¨å±€æ­£åˆ™çš„ `lastIndex` åœ¨æ¯æ¬¡ `.test()` åé€’å¢ï¼Œå¯¼è‡´è¿ç»­è°ƒç”¨å¯èƒ½è¿”å›é”™è¯¯ç»“æœã€‚

```js
// sanitize.js:37
sensitiveRegex = new RegExp(escaped.join("|"), "gi");
// è¿ç»­è°ƒç”¨ .test() ä¼šäº¤æ›¿è¿”å› true/false
```

**ä¿®å¤**ï¼š`.test()` å‰é‡ç½® `lastIndex = 0`ï¼Œæˆ–å»æ‰ `g` æ ‡å¿—ï¼ˆ`.test()` ä¸éœ€è¦å…¨å±€åŒ¹é…ï¼‰ã€‚

---

### 1.4 âš ï¸ ID ç”Ÿæˆç¢°æ’é£é™©

**ç°çŠ¶**ï¼šå¤§å¤šæ•° service ç”¨ `Date.now()` ç”Ÿæˆ IDï¼Œå¿«é€Ÿæ“ä½œï¼ˆå¦‚è¿ç»­å‘æ¶ˆæ¯ï¼‰ä¼šäº§ç”Ÿé‡å¤ IDã€‚

```js
id: `conv-${Date.now()}`   // chat-service
id: `order-${Date.now()}`  // order-service
```

å”¯ä¸€ä¾‹å¤–æ˜¯ `points-service` åŠ äº†éšæœºåç¼€ï¼š`pt-${Date.now()}-${Math.random().toString(36).slice(2,6)}`

**ä¼˜åŒ–**ï¼šæå– `generateId(prefix)` åˆ° `utils/common.js`ï¼š

```js
export function generateId(prefix = "id") {
  return `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;
}
```

---

### 1.5 âš ï¸ `mock-products.js` æ—¶é—´æˆ³å¤±æ•ˆ

**ç°çŠ¶**ï¼š

```js
const now = getNow();  // ä»…æ¨¡å—åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡
```

æ³¨é‡Šè¯´"ç¡®ä¿æ¯æ¬¡è·å–æœ€æ–°æ—¶é—´"ï¼Œä½† `now` åœ¨ `import` æ—¶å›ºå®šï¼Œé•¿æ—¶é—´ä½¿ç”¨åæ—¶é—´åç§»è¶Šæ¥è¶Šå¤§ã€‚

**ä¿®å¤**ï¼šæ”¹ä¸º getter å‡½æ•°æˆ–åœ¨ `mockProducts` å¯¼å‡ºæ—¶ç”¨å‡½æ•°ç”Ÿæˆã€‚

---

### 1.6 ğŸ’¡ `request.js` æœªé›†æˆé”™è¯¯å¤„ç†

**ç°çŠ¶**ï¼š`request.js` è‡ªæˆä½“ç³»ï¼Œæœªä½¿ç”¨ `error-handler.js` çš„ `classifyError`ã€‚ç½‘ç»œé”™è¯¯ã€401ã€403 ç­‰æ²¡æœ‰ç»Ÿä¸€æ‹¦æˆªã€‚

**ä¼˜åŒ–**ï¼šåœ¨ `request()` çš„ `fail` å’Œ `success` åˆ†æ”¯ä¸­é›†æˆ `classifyError`ï¼Œå®ç°ï¼š
- 401 â†’ è‡ªåŠ¨è·³ç™»å½•é¡µ
- 403 â†’ æƒé™ä¸è¶³æç¤º
- ç½‘ç»œé”™è¯¯ â†’ ç»Ÿä¸€é‡è¯•æç¤º

---

### 1.7 ğŸ’¡ `date.js` åŠŸèƒ½ä¸è¶³

**ç°çŠ¶**ï¼šä»… `formatRelativeTime` ä¸€ä¸ªå‡½æ•°ã€‚å¤šä¸ªé¡µé¢éœ€è¦ä½†ç¼ºå°‘ï¼š`formatDate`ã€`formatDateTime`ã€`isToday`ã€`isSameDay`ã€‚

**ä¼˜åŒ–**ï¼šæ‰©å±•å¸¸ç”¨æ—¥æœŸå·¥å…·å‡½æ•°ã€‚

---

## äºŒã€Store çŠ¶æ€ç®¡ç†å±‚

### 2.1 âš ï¸ User Store ç¼ºå°‘å¸¸ç”¨æ´¾ç”Ÿå±æ€§

**ç°çŠ¶**ï¼šå¤šä¸ªé¡µé¢é‡å¤å†™ fallback é€»è¾‘ï¼š

```js
// pages/profile/index.vue:132
this.userStore.profile || {
  nickName: "æ ¡å›­ç”¨æˆ·",
  avatar: "https://picsum.photos/seed/profile-default/120/120",
  ...
}
```

**ä¼˜åŒ–**ï¼šåœ¨ store çš„ `getters` ä¸­æä¾›å¸¦ fallback çš„å®Œæ•´ `safeProfile`ï¼š

```js
safeProfile: (state) => ({
  nickName: "æ ¡å›­ç”¨æˆ·",
  avatar: "https://picsum.photos/seed/profile-default/120/120",
  productCount: 0, taskCount: 0, favoriteCount: 0,
  ...state.profile
})
```

---

### 2.2 ğŸ’¡ ç¼ºå°‘å…¨å±€ç™»å½•å®ˆå«

**ç°çŠ¶**ï¼šå‡ ä¹æ¯ä¸ªéœ€è¦ç™»å½•çš„é¡µé¢éƒ½æ‰‹åŠ¨æ£€æŸ¥ï¼š

```js
if (!this.isLogin) { this.goLogin(); return; }
```

`goLogin()` æ–¹æ³•åœ¨ 5+ ä¸ªé¡µé¢é‡å¤å®šä¹‰ã€‚

**ä¼˜åŒ–**ï¼š
1. åœ¨ store ä¸­æä¾› `requireLogin()` actionï¼Œç»Ÿä¸€è·³è½¬é€»è¾‘
2. æˆ–é€šè¿‡é¡µé¢ mixin / è·¯ç”±æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†

---

## ä¸‰ã€Pages é¡µé¢å±‚

### 3.1 âš ï¸ å•†å“å¡ç‰‡ `cover-shine` æ— é™åŠ¨ç”»æ€§èƒ½é—®é¢˜

**ç°çŠ¶**ï¼š`product-card.vue` æ¯å¼ å¡ç‰‡éƒ½æœ‰ä¸€ä¸ªæ— é™å¾ªç¯çš„ CSS å…‰æ³½åŠ¨ç”»ï¼š

```css
.cover-shine {
  animation: anim-img-shine 3s ease-in-out infinite;
}
```

åœ¨å•†å“åˆ—è¡¨é¡µæœ‰ 10+ å¼ å¡ç‰‡æ—¶ï¼Œä¼šæœ‰ 10+ ä¸ªæ— é™åŠ¨ç”»åŒæ—¶è¿è¡Œï¼Œæ¶ˆè€— GPU åˆæˆå±‚èµ„æºã€‚

**ä¼˜åŒ–**ï¼š
1. æ”¹ä¸º `hover` / `:active` æ—¶è§¦å‘ï¼Œæˆ–ä»…å‰ 3 å¼ å¡ç‰‡å¼€å¯
2. æˆ–ç”¨ `animation-play-state: paused` + IntersectionObserver ä»…å¯è§†åŒºåŸŸæ’­æ”¾

---

### 3.2 âš ï¸ åˆ—è¡¨é¡µæ— è™šæ‹Ÿæ»šåŠ¨

**ç°çŠ¶**ï¼šå•†å“åˆ—è¡¨ã€ä»»åŠ¡åˆ—è¡¨ã€åŠ¨æ€åˆ—è¡¨ç­‰é¡µé¢ç›´æ¥ `v-for` æ¸²æŸ“å…¨é‡æ•°æ®ã€‚

**é£é™©**ï¼šæ•°æ®è¶…è¿‡ 50 æ¡æ—¶ DOM èŠ‚ç‚¹è¿‡å¤šï¼Œæ»šåŠ¨å¡é¡¿ã€‚

**ä¼˜åŒ–**ï¼š
1. å°ç¨‹åºç«¯å¯ç”¨åˆ†é¡µåŠ è½½ï¼ˆå·²éƒ¨åˆ†å®ç° `enablePullDownRefresh`ï¼‰
2. è¡¥å……è§¦åº•åŠ è½½æ›´å¤šï¼ˆ`onReachBottom`ï¼‰å’Œæ•°æ®åˆ‡ç‰‡

---

### 3.3 ğŸ’¡ é¡µé¢é—´æ— æ•°æ®ç¼“å­˜

**ç°çŠ¶**ï¼šä»åˆ—è¡¨è¿›å…¥è¯¦æƒ…å†è¿”å›ï¼Œåˆ—è¡¨ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚

**ä¼˜åŒ–**ï¼šåˆ©ç”¨ Pinia store æˆ–é¡µé¢çº§ç¼“å­˜ï¼ˆ`onShow` æ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ·æ–°ï¼‰ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡å¤è¯·æ±‚ã€‚

---

### 3.4 ğŸ’¡ å•†å“è¯¦æƒ…é¡µç¼ºå°‘éª¨æ¶å±

**ç°çŠ¶**ï¼š`detail.vue` ä»…æ˜¾ç¤º "åŠ è½½å•†å“è¯¦æƒ…ä¸­..." æ–‡å­—ã€‚

**ä¼˜åŒ–**ï¼šä½¿ç”¨å·²æœ‰çš„ `.skeleton-shimmer` å…¨å±€ç±»æ„å»ºå•†å“è¯¦æƒ…éª¨æ¶å±ï¼Œæå‡æ„ŸçŸ¥é€Ÿåº¦ã€‚

---

## å››ã€Components ç»„ä»¶å±‚

### 4.1 âš ï¸ å¯å¤ç”¨ç»„ä»¶è¿‡å°‘

**ç°çŠ¶**ï¼šä»… 2 ä¸ªç»„ä»¶ï¼ˆ`product-card`ã€`empty-state`ï¼‰ï¼Œå¤§é‡ UI æ¨¡å¼åœ¨é¡µé¢é—´é‡å¤ï¼š

| é‡å¤æ¨¡å¼ | å‡ºç°é¡µé¢ |
|---------|---------|
| ç»Ÿè®¡è¡Œ (stat-row/stat-pill) | indexã€profileã€chat |
| æ®µè½æ ‡é¢˜ (section-head) | indexã€chatã€products/list |
| ç»ç’ƒå¡ç‰‡ hero åŒºåŸŸ | indexã€profileã€chatã€login |
| æ“ä½œåº•æ  (actions bar) | products/detailã€orders/detail |

**ä¼˜åŒ–**ï¼šæå– 3~4 ä¸ªé«˜é¢‘ç»„ä»¶ï¼š`section-header`ã€`stat-row`ã€`action-bar`ã€`skeleton-card`ã€‚

---

## äº”ã€CSS / æ ·å¼å±‚

### 5.1 âš ï¸ App.vue å…¨å±€ CSS ä½“ç§¯è¿‡å¤§ï¼ˆ500+ è¡Œï¼‰

**ç°çŠ¶**ï¼šApp.vue åŒ…å« 30+ ä¸ª `@keyframes` åŠ¨ç”»å’Œ 40+ ä¸ªå·¥å…·ç±»ã€‚å°ç¨‹åºä¸­å…¨å±€æ ·å¼ä¼šæ³¨å…¥åˆ°æ¯ä¸ªé¡µé¢ã€‚

**å½±å“**ï¼šæ¯ä¸ªé¡µé¢çš„ wxss éƒ½åŒ…å«å…¨éƒ¨å…¨å±€æ ·å¼ï¼Œå½±å“é¦–å±è§£æé€Ÿåº¦ã€‚

**ä¼˜åŒ–**ï¼š
1. å°†ä¸å¸¸ç”¨çš„åŠ¨ç”»ï¼ˆ`anim-rubber`ã€`anim-tada`ã€`anim-jelly`ã€`anim-heart-beat`ã€`anim-confetti-pop` ç­‰ï¼‰ç§»åˆ°æŒ‰éœ€å¼•å…¥çš„æ–‡ä»¶
2. ä¿ç•™æ ¸å¿ƒåŠ¨ç”»ï¼ˆ`fade-in`ã€`slide-up`ã€`bounce-in`ã€`float`ï¼‰åœ¨å…¨å±€

---

### 5.2 âš ï¸ `animation-fill-mode: both` çš„ transform è¦†ç›–é™·é˜±

**ç°çŠ¶**ï¼šæ‰€æœ‰å…¥åœºåŠ¨ç”»ä½¿ç”¨ `both`ï¼ˆå·²å¯¼è‡´è¿‡ chat-list æ»‘åŠ¨åŠŸèƒ½ bugï¼‰ã€‚

```css
.anim-slide-up { animation: anim-slide-up 0.5s ease both; }
```

`both` è®©åŠ¨ç”»ç»“æŸå `transform: translateY(0)` æŒç»­ç”Ÿæ•ˆï¼Œä¼šè¦†ç›–åç»­ JS è®¾ç½®çš„ `transform`ã€‚

**ä¼˜åŒ–**ï¼šæ”¹ä¸º `forwards` æˆ–åœ¨åŠ¨ç”»ç»“æŸåç§»é™¤åŠ¨ç”»ç±»ã€‚

---

## å…­ã€æ•°æ®æŒä¹…åŒ–å±‚

### 6.1 âš ï¸ å…¨é‡åŒæ­¥å­˜å‚¨é˜»å¡ä¸»çº¿ç¨‹

**ç°çŠ¶**ï¼šæ‰€æœ‰ service ä½¿ç”¨ `uni.getStorageSync` / `uni.setStorageSync`ã€‚

**é£é™©**ï¼šå½“ä¼šè¯æ•°æ®ã€ç§¯åˆ†æµæ°´ç­‰æ•°æ®é‡å¤§æ—¶ï¼ŒåŒæ­¥è¯»å†™é˜»å¡ UI çº¿ç¨‹ï¼Œé€ æˆå¡é¡¿ã€‚

**ä¼˜åŒ–**ï¼š
1. é«˜é¢‘è¯»å†™è·¯å¾„æ”¹ç”¨ `uni.getStorage` / `uni.setStorage`ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰
2. æ‰¹é‡å†™å…¥æ—¶æ·»åŠ èŠ‚æµï¼ˆå¦‚ `chat-service` çš„æ¶ˆæ¯ä¿å­˜ï¼‰

---

### 6.2 ğŸ’¡ æ— å­˜å‚¨ç”¨é‡ç›‘æ§

**ç°çŠ¶**ï¼šå¾®ä¿¡å°ç¨‹åºæœ¬åœ°å­˜å‚¨ä¸Šé™ 10MBï¼Œä½†æ²¡æœ‰ä»»ä½•ç”¨é‡æ£€æµ‹ã€‚

**ä¼˜åŒ–**ï¼šæ·»åŠ  `utils/storage-monitor.js`ï¼Œå®šæœŸæ£€æµ‹å­˜å‚¨ç”¨é‡å¹¶åœ¨æ¥è¿‘ä¸Šé™æ—¶æ¸…ç†è¿‡æœŸæ•°æ®ã€‚

---

## ä¸ƒã€äº‘æœåŠ¡å±‚

### 7.1 ğŸ’¡ ç¼ºå°‘äº‘è¿æ¥å¥åº·æ£€æµ‹

**ç°çŠ¶**ï¼š`cloud.js` åªåœ¨ `initCloud` æ—¶æ£€æŸ¥ `wx.cloud` æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æœ‰è¿è¡Œæ—¶å¥åº·æ£€æµ‹ã€‚

**é£é™©**ï¼šäº‘æœåŠ¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ–­å¼€åï¼Œæ‰€æœ‰è¯·æ±‚ä¼šå…ˆå°è¯•äº‘ï¼ˆå¤±è´¥ï¼‰å†é™çº§æœ¬åœ°ï¼Œå¢åŠ å»¶è¿Ÿã€‚

**ä¼˜åŒ–**ï¼šæ·»åŠ ç®€å•çš„å¿ƒè·³æ£€æµ‹ï¼Œäº‘ä¸å¯ç”¨æ—¶ç›´æ¥èµ°æœ¬åœ°é€šé“ï¼Œé¿å…æ¯æ¬¡è¯·æ±‚éƒ½è¶…æ—¶ã€‚

---

## å…«ã€å®‰å…¨å±‚

### 8.1 âš ï¸ `sanitizeText` ä½¿ç”¨ä¸ä¸€è‡´

**ç°çŠ¶**ï¼š
- âœ… ä½¿ç”¨äº† sanitizeï¼š`chat-service`ï¼ˆæ¶ˆæ¯å†…å®¹ï¼‰ã€`feed-service`ï¼ˆåŠ¨æ€å†…å®¹ï¼‰ã€`want-service`ï¼ˆæ±‚è´­æè¿°ï¼‰
- âŒ æœªä½¿ç”¨ sanitizeï¼š`task-service`ï¼ˆä»»åŠ¡æè¿°ï¼‰ã€`wiki-service`ï¼ˆæ–‡ç« å†…å®¹ï¼‰ã€`products/publish`ï¼ˆå•†å“æè¿°ï¼‰

**ä¼˜åŒ–**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å­—æ®µåœ¨å†™å…¥å‰ç»Ÿä¸€è¿‡ `sanitizeText`ã€‚

---

## ä¼˜åŒ–ä¼˜å…ˆçº§æ±‡æ€»

| ä¼˜å…ˆçº§ | ç¼–å· | ä¼˜åŒ–é¡¹ | ç±»å‹ |
|--------|------|--------|------|
| ğŸ”´ P0 | 1.3 | sanitize.js å…¨å±€æ­£åˆ™ bug | Bug |
| ğŸ”´ P0 | 1.4 | ID ç”Ÿæˆç¢°æ’é£é™© | Bug |
| ğŸŸ  P1 | 1.1 | 8 ä¸ª service é‡å¤ä»£ç æå– | é‡æ„ |
| ğŸŸ  P1 | 1.2 | é”™è¯¯å¤„ç†ç»Ÿä¸€ | å¥å£®æ€§ |
| ğŸŸ  P1 | 3.1 | å•†å“å¡ç‰‡æ— é™åŠ¨ç”»æ€§èƒ½ | æ€§èƒ½ |
| ğŸŸ  P1 | 5.2 | animation-fill-mode é™·é˜± | ç¨³å®šæ€§ |
| ğŸŸ  P1 | 8.1 | sanitizeText å…¨è¦†ç›– | å®‰å…¨ |
| ğŸŸ¡ P2 | 1.5 | mock æ—¶é—´æˆ³å¤±æ•ˆ | Bug |
| ğŸŸ¡ P2 | 1.6 | request.js é›†æˆé”™è¯¯å¤„ç† | å¥å£®æ€§ |
| ğŸŸ¡ P2 | 2.1 | Store safeProfile getter | ä»£ç è´¨é‡ |
| ğŸŸ¡ P2 | 2.2 | å…¨å±€ç™»å½•å®ˆå« | ä»£ç è´¨é‡ |
| ğŸŸ¡ P2 | 4.1 | æå–é«˜é¢‘ç»„ä»¶ | å¯ç»´æŠ¤æ€§ |
| ğŸŸ¡ P2 | 5.1 | å…¨å±€ CSS ç˜¦èº« | æ€§èƒ½ |
| ğŸŸ¡ P2 | 6.1 | å¼‚æ­¥å­˜å‚¨ + èŠ‚æµ | æ€§èƒ½ |
| ğŸŸ¢ P3 | 1.7 | date.js æ‰©å±• | åŠŸèƒ½ |
| ğŸŸ¢ P3 | 3.2 | åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ / åˆ†é¡µ | æ€§èƒ½ |
| ğŸŸ¢ P3 | 3.3 | é¡µé¢é—´æ•°æ®ç¼“å­˜ | ä½“éªŒ |
| ğŸŸ¢ P3 | 3.4 | è¯¦æƒ…é¡µéª¨æ¶å± | ä½“éªŒ |
| ğŸŸ¢ P3 | 6.2 | å­˜å‚¨ç”¨é‡ç›‘æ§ | å¥å£®æ€§ |
| ğŸŸ¢ P3 | 7.1 | äº‘è¿æ¥å¥åº·æ£€æµ‹ | å¥å£®æ€§ |

---

## âœ… å®æ–½è®°å½•

> ä»¥ä¸‹ä¼˜åŒ–é¡¹å·²å…¨éƒ¨å®æ–½å¹¶é€šè¿‡ç¼–è¯‘éªŒè¯ï¼ˆBuild completeï¼‰

### å·²å®Œæˆ

| ç¼–å· | ä¼˜åŒ–é¡¹ | æ”¹åŠ¨æ–‡ä»¶ | æ”¹åŠ¨è¯´æ˜ |
|------|--------|---------|---------|
| 1.3 | sanitize.js æ­£åˆ™ bug | `utils/sanitize.js` | æ‹†åˆ†ä¸º `sensitiveTestRegex`ï¼ˆæ—  `g`ï¼‰å’Œ `sensitiveReplaceRegex`ï¼ˆå¸¦ `gi`ï¼‰ï¼Œå½»åº•æ¶ˆé™¤ `lastIndex` é—®é¢˜ |
| 1.4 | ID ç¢°æ’ | `utils/common.js` + 10 ä¸ª service | æ–°å»º `generateId(prefix)` å‡½æ•°ï¼ˆæ—¶é—´æˆ³+6ä½éšæœºï¼‰ï¼Œæ›¿æ¢å…¨éƒ¨ `` `xxx-${Date.now()}` `` æ¨¡å¼ |
| 1.1 | é‡å¤ä»£ç  | 9 ä¸ª service æ–‡ä»¶ | æå– `getCurrentProfile`/`getCurrentUserId`/`wait` åˆ° `utils/common.js`ï¼Œåˆ é™¤ ~90 è¡Œé‡å¤ä»£ç  |
| 1.2+8.1 | é”™è¯¯å¤„ç†+å®‰å…¨è¦†ç›– | `task-service`ã€`wiki-service`ã€`report-service`ã€`request.js` | æ–°å¢ `sanitizeText` è¦†ç›–ã€`request.js` é›†æˆ `classifyError`+`showError` |
| 3.1 | å¡ç‰‡åŠ¨ç”»æ€§èƒ½ | `components/product-card/product-card.vue` | `cover-shine` ä» `infinite` æ”¹ä¸ºæ’­æ”¾ `1` æ¬¡ |
| 5.2 | fill-mode é™·é˜± | `App.vue` | å…¨éƒ¨ 9 ä¸ªå…¥åœºåŠ¨ç”» `both` â†’ `forwards` |
| 1.5 | mock æ—¶é—´æˆ³ | `utils/mock-products.js` | `const now = getNow()` â†’ `function now()` å‡½æ•°è°ƒç”¨ |
| 1.6 | request é”™è¯¯å¤„ç† | `utils/request.js` | `fail` å›è°ƒé›†æˆ `classifyError`+`showError`ï¼Œæ”¯æŒ `silent` é€‰é¡¹ |
| 2.1+2.2 | Store å¢å¼º | `store/user.js` | æ–°å¢ `safeProfile` getterï¼ˆå¸¦ fallbackï¼‰ã€`requireLogin()` action |
| 5.1 | CSS ç˜¦èº« | `App.vue` â†’ `styles/anim-extra.scss` | æå– 5 ä¸ªä½é¢‘åŠ¨ç”»ï¼ˆrubber/tada/jelly/heart/confetti/bubbleï¼‰ï¼Œå…¨å±€å‡å°‘ ~60 è¡Œ |
| 6.1 | å†™å…¥èŠ‚æµ | `utils/common.js` + `chat-service.js` | æ–°å¢ `createThrottledStorage`ï¼ŒèŠå¤©æ¶ˆæ¯å†™å…¥èŠ‚æµ 200ms |
| 1.7 | date.js æ‰©å±• | `utils/date.js` | æ–°å¢ `formatDate`ã€`formatDateTime`ã€`isToday`ã€`isSameDay` |

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `utils/common.js` | å…¬å…±å·¥å…·ï¼š`generateId`ã€`getCurrentUserId`ã€`wait`ã€`createThrottledStorage` |
| `styles/anim-extra.scss` | ä½é¢‘åŠ¨ç”»æŒ‰éœ€å¼•å…¥ï¼ˆä»… `feeds/detail.vue` ä½¿ç”¨ï¼‰ |

### å¾…åç»­ä¼˜åŒ–ï¼ˆæœªå®æ–½ï¼‰

- 3.2 åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ / åˆ†é¡µ
- 3.3 é¡µé¢é—´æ•°æ®ç¼“å­˜
- 3.4 å•†å“è¯¦æƒ…éª¨æ¶å±
- 4.1 æå–é«˜é¢‘ UI ç»„ä»¶
- 6.2 å­˜å‚¨ç”¨é‡ç›‘æ§
- 7.1 äº‘è¿æ¥å¥åº·æ£€æµ‹
